{% extends 'base.html' %}
{% block content %}
<div class="page-header fade-in">
  <div class="header-content">
    <h1 class="page-title">Budgets</h1>
    <p class="page-subtitle">Set spending limits and track your financial goals</p>
  </div>
</div>

{% if messages %}
  {% for message in messages %}
    <div class="alert-banner {% if 'error' in message.tags %}error{% elif 'warning' in message.tags %}warning{% else %}success{% endif %} fade-up">
      <span class="alert-icon">{% if 'error' in message.tags %}âŒ{% elif 'warning' in message.tags %}âš ï¸{% else %}âœ…{% endif %}</span>
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

<div class="form-section fade-up">
  <div class="glass-card">
    <div class="card-header">
      <div class="card-title">
        <span class="title-icon">ğŸ’°</span>
        <h3>Create Budget</h3>
      </div>
    </div>
    <form method="POST" class="premium-form">
      {% csrf_token %}
      <div class="form-grid">
        <div class="form-group">
          <label>Category Name</label>
          <input type="text" name="category" required placeholder="e.g., Food, Transport, Shopping">
        </div>
        
        <div class="form-group">
          <label>Budget Limit (â‚¹)</label>
          <input type="number" step="0.01" name="limit_amount" placeholder="Enter budget limit" required>
        </div>
        
        <div class="form-group">
          <label>Alert Threshold (%)</label>
          <input type="number" name="alert_threshold" value="80" min="1" max="100" required>
          <span class="form-hint">Get notified when spending reaches this %</span>
        </div>
      </div>
      
      <button class="btn btn-primary btn-lg" type="submit">
        <span>ğŸ’°</span> Create Budget
      </button>
    </form>
  </div>
</div>

<div class="table-section fade-up">
  <div class="glass-card">
    <div class="card-header">
      <div class="card-title">
        <span class="title-icon">ğŸ“Š</span>
        <h3>Your Budgets</h3>
      </div>
      {% if budgets %}
      <span class="card-badge">{{ budgets|length }} categories</span>
      {% endif %}
    </div>
    
    {% if budgets %}
    <div class="budget-cards">
      {% for budget in budgets %}
      <div class="budget-card-item {% if budget.percentage >= 100 %}exceeded{% elif budget.percentage >= budget.alert_threshold %}warning{% else %}healthy{% endif %}">
        <div class="budget-card-header">
          <span class="budget-card-category">{{ budget.category }}</span>
          <span class="budget-card-status">
            {% if budget.percentage >= 100 %}
              <span class="status-badge danger">ğŸš« Exceeded</span>
            {% elif budget.percentage >= budget.alert_threshold %}
              <span class="status-badge warning">âš ï¸ Warning</span>
            {% else %}
              <span class="status-badge success">âœ… On Track</span>
            {% endif %}
          </span>
        </div>
        
        <div class="budget-card-progress">
          <div class="progress-bar">
            <div class="progress-fill {% if budget.percentage >= 100 %}danger{% elif budget.percentage >= budget.alert_threshold %}warning{% else %}success{% endif %}" style="width: min(100%, {{ budget.percentage }}%)"></div>
          </div>
          <div class="progress-labels">
            <span class="spent">â‚¹{{ budget.spent_amount|floatformat:0 }}</span>
            <span class="limit">â‚¹{{ budget.limit_amount|floatformat:0 }}</span>
          </div>
        </div>
        
        <div class="budget-card-stats">
          <div class="stat">
            <span class="stat-label">Usage</span>
            <span class="stat-value {% if budget.percentage >= 100 %}danger{% elif budget.percentage >= budget.alert_threshold %}warning{% else %}success{% endif %}">{{ budget.percentage }}%</span>
          </div>
          <div class="stat">
            <span class="stat-label">Remaining</span>
            <span class="stat-value {% if budget.remaining < 0 %}danger{% else %}success{% endif %}">â‚¹{{ budget.remaining|floatformat:0 }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Alert At</span>
            <span class="stat-value">{{ budget.alert_threshold }}%</span>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state-small">
      <span>ğŸ“Š</span>
      <p>No budgets yet. Create your first budget above to start tracking!</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
